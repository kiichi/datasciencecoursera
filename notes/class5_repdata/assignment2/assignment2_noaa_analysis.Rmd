---
title: "Public Health and Economic Impact Analysis by Severe Wheater Events"
author: "Kiichi Takeuchi"
date: "July 23, 2014"
output: html_document
---

##Setup
First, setup your work directory path. For example, here is my path below. If you are using R Studio, you can also set it from Session > Set Working Directory > To Source File Location.

```{r pathsetup,echo=TRUE}
setwd("~/work/r/class/datasciencecoursera/notes/class5_repdata/assignment2")
```

Below is the list of required R packages for this analysis:

* data.table
* ggplot2
* R.utils
* gridExtra
* ??? ... (add more)

Download and extract Zip file if it was not extracted yet
```{r unzipping,echo=TRUE,results='hide'}

library(R.utils)
if (!file.exists("storm.bz2")){
  download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2","storm.bz2",method="curl")
}

if (!file.exists("storm")){
  bunzip2("storm.bz2")
}
```

As for references, you can take a look at NOAA's documentations.

* https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf
* https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf

#Load Library and Utility Functions
```{r load_lib,echo=TRUE,cache=TRUE}
library(data.table)
cleanup <- function (x)  {
  toupper(gsub("^\\s+|\\s+$", "", x))
}
```

##Loading Data
Next, load the data file. Since I got error with fread function, I'm using read.csv first, then I'm converting into data.table type.
```{r loading,echo=TRUE,cache=TRUE}
d<-data.table(read.csv("storm"))
```

```{r preprocess,echo=TRUE,cache=TRUE}
d[,c("EVTYPE")] <- cleanup(d[EVTYPE %like% 'SUMMARY',]$EVTYPE)
```

```{r analysis,echo=TRUE}
colnames(d)
#PH - Public Health
#EM - Economic Impact
# Ranking
rk<-d[,list(PH=sum(FATALITIES,na.rm=T),EI=sum(PROPDMG,na.rm=T)),by=EVTYPE]
rk[order(EVTYPE)]$EVTYPE
```


















